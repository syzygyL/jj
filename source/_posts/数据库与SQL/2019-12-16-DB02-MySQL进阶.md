---
title: DB02-MySQL进阶
tags:
  - note
  - SQL
comments: false
categories:
  - 数据库与SQL
date: 2019-12-16 20:10:10
description:
top:
---

## MySQL 进阶

## 数据类型（字段）

### 数值类型

#### 整形

|类型名|字节长度|范围( 有符号位 )|
|------|-------|----|
|tinyint|1 字节|-128 ~ 127|
|smallint|2 字节|-32768 ~ 32768|
|mediumint|3 字节|-8388608 ~ 8388607|
|int|4 字节||
|bigint|8 字节||
|int(M)|M bit||

* 整形默认存在符号位 ， 可以使用 unsigned 修改成无符号
* 整形数据在满足要求的情况下，尽量使用字节长度小的

#### 浮点型

|类型名|字节长度|范围( 有符号位 )|
|------|-------|----|
|float |4 字节||
|double|8 字节||

* 浮点型存在符号位 ， 可以使用 unsigned 修改成无符号
* 定义浮点型字段时，需指定总位数和小数位数（ M ，D ） ， M 表示总位数 D 表示小数位数 ， 浮点数的范围由 M 和 D 来确定，不同于整形的固定范围

#### 定点型
定点型 decimal ( M ， D )， M 表示总位数 D 表示小数位数

### 字符串类型
|类型名|是否可变长|能表示的字符个数|
|------|-------|----|
|char|定长|0 ~ 255 ( 与编码无关 )|
|varchar|不定长|0 ~ 65536 ( 与编码有关 )|

* varchar 类型使用时需指定长度 varchar()

### 日期时间类型

|类型名|字节长度|含义|
|------|-------|----|
|datetime|8 字节|日期及时间|
|date |3 字节|日期|
|timestamp|4 字节|时间戳|
|time|3 字节|时间|
|year|1 字节|年份|

### 枚举和集合

* 枚举 ( enum ) ：在建表时使用，用于添加时**限定添加数据的可能性**，枚举列表内可以预存 65536 个值，值的类型只能是字符串类型，但在底层是列表顺序以从 1 开始依次自增 1 的整形值存储
定义格式 ：`字段名 enum(枚举值1 ， 枚举2 ，...枚举值n) DEFAULT 默认值`
* 集合 ( set ) ：在建表时使用，用于在添加时**可以添加一批集合内的数据**，集合列表内可以预存 64 个值，值的类型值的类型只能是字符串类型，但在底层是列表顺序以从 1 开始依次自增两倍的整形值存储
定义格式 ：`字段名 set(值1 ，值2 ，...值n)`

#### set 建表案例

```sql
mysql> CREATE TABLE set_table ( id INT auto_increment PRIMARY KEY， hobby SET ( 'music'， 'movie'， 'swimming'， 'footbal' ) );
mysql> INSERT INTO set_table ( id， hobby ) VALUES ( NULL， 'music' );
mysql> INSERT INTO set_table ( id， hobby ) VALUES ( NULL， 'movie' );
mysql> INSERT INTO set_table ( id， hobby ) VALUES ( NULL， 'swimming，footbal' );
```

```sql
mysql> SELECT * FROM set_table;
+----+------------------+
| id | hobby            |
+----+------------------+
|  1 | music            |
|  2 | movie            |
|  3 | swimming，footbal |
+----+------------------+
3 rows in set (0.00 sec)
```

## 范式

范式( Normal form )：为了减少不必要的数据冗余，我们在设计关系数据库时，遵从不同的规范要求，设计出合理的关系型数据库，这些不同的规范要求被称为不同的范式，各种范式呈递次规范，越高的范式数据库冗余越小

### 1NF

第一范式：表内的字段不能再拆分，确保表中每列的原子性

### 2NF

第二范式：满足第一范式的前提下 ， 不能出现部分依赖 ， 确保表中每列都与主键相关联

### 3NF

第三范式：满足第二范式的前提下 ， 不能出现传递依赖 ， 确保表中每列都与主键直接关联


## 多表查询

笛卡尔积：集合 A 、B ， 取这两个集合的元素的所有组成情况

### 表关系

一对一
一对多
多对多（一对多+一对多）

### 级联

级联删除：

如果数据库外键关联设置为CASEADE:

如果要删除多的一方，则可直接删除，并且与之关联的一方也删除了

如果数据库关联外键没有设置为CASEADE

在删除时需要先把引用外键的一方设置为null,然后在删除。

级联插入：

先插入一条一的记录，然后得到其主键

然后查找出刚插入进去的记录，通过多的一方的SET方法将其SET进去

然后将多的一方的对象统一插入进去


### 内连接查询

* 隐式内连接查询：`SELECT * FROM 主表，副表 WHERE 连接条件`
* 显式内连接查询：`SELECT * FROM 主表 [INNER] JOIN 副表 ON 连接条件`

**特点**：查询出**满足连接条件的数据**，过滤掉不满足连接条件的

### 外连接查询  

* 左外连接查询：用法：`SELECT * FROM 主表 LEFT [OUTER] JOIN 副表 ON 连接条件`
    * 以 JOIN 左边的表作为主表，查询出主表的全部数据 ， 以及满足连接条件的副表数据
* 右外连接查询：用法：`SELECT * FROM 副表 RIGHT [OUTER] JOIN 主表 ON 连接条件`
    * 以 JOIN 右边的表作为主表，查询出主表的全部数据 ， 以及满足连接条件的副表数据

**特点**：查询出**主表的所有数据以及满足条件的副表数据**，过滤掉不满足连接条件的

### 子查询

将 SELECT 语句 A ， 作为 SELECT 语句 B 的 WHERE 子句的条件体
例如：`SELECT 字段 FROM 表名 WHERE (SELECT 字段 FROM 表名);` 这条 sql 语句括号里面的 SELECT 子句就是子查询

子查询的结果：
* 单行单列：可作为条件体，代表只有一条数据 ，直接在 WHERE 后面作为条件提供给外部查询 ，搭配比较运算符使用 ，如：> 、< 、<> 、=
* 单行单列：可以作为 where 条件
* 单行多列：可以映射为一个 POJO 实例
* 多行单列：可作为条件体，代表子查询的结果是一个数组 ，可通过 IN 子句将结果提供给外部查询
* 多行多列：不可作为条件体，代表子查询的结果是一张虚拟表 ，可通过 FROM 子句将此表提供给外部查询

**特点**：**查询中嵌套别的查询**
