---
title: RabbitMQ
tags:
  - note
comments: false
date: 2020-03-27 09:36:05
categories:
description:
top:
---

### 什么是MQ

消息队列（Message Queue，简称MQ），存储的数据结构为队列，存储的元素是一条条消息，符合 FIFO。其主要用途：不同进程Process/线程Thread之间通信。MQ是一种非常常见的上下游“逻辑解耦+物理解耦”的消息通信服务

为什么会需要消息队列(MQ)？

主要原因是由于在高并发环境下，由于来不及同步处理，请求往往会发生堵塞，比如说，大量的insert，update之类的请求同时到达`MySQL`，直接导致无数的行锁表锁，甚至最后请求会堆积过多，从而触发**too many connections**错误。通过使用消息队列，我们可以异步处理请求，从而缓解系统的压力。

应用场景：异步处理、应用解耦、流量削峰

MQ的不足是：

* 系统更复杂，多了一个MQ组件
* 消息传递路径更长，延时会增加
* 消息可靠性和重复性互为矛盾，消息不丢不重难以同时保证
* 上游无法知道下游的执行结果，这一点是很致命的

无论如何，记住这个结论：**调用方实时依赖执行结果的业务场景，请使用调用，而不是MQ**

**概念介绍**:

Broker:它提供一种传输服务,它的角色就是维护一条从生产者到消费者的路线，保证数据能按照指定的方式进行传输,
Exchange：消息交换机,它指定消息按什么规则,路由到哪个队列。
Queue:消息的载体,每个消息都会被投到一个或多个队列。
Binding:绑定，它的作用就是把exchange和queue按照路由规则绑定起来.
Routing Key:路由关键字,exchange根据这个关键字进行消息投递。
vhost:虚拟主机,一个broker里可以有多个vhost，用作不同用户的权限分离。
Producer:消息生产者,就是投递消息的程序.
Consumer:消息消费者,就是接受消息的程序.
Channel:消息通道,在客户端的每个连接里,可建立多个channel.


RabbitMQ 基础设施：交换机、队列、绑定（交换机和队列的粘合剂）

发布者将无法发布到不存在的交换机，并且消费者也无法从不存在的队列中获取消息。